import type {Meta, TocEntry} from '@ioclub/mdvue'

import { defineComponent, provide, reactive } from 'vue'

import Default from './default'
import News from './news'
// import {article} from "windicss/plugin/typography"
export default defineComponent({
	props: {'name': String},
	setup(_, {slots}) {
		const meta: Meta = reactive({})
		const updateMeta = (n: Meta) => {
			meta.frontmatter = n.frontmatter
			meta.toc = n.toc
		}
		watchEffect(() =>
			console.log(meta), {
			flush: 'post'
		})
		provide('md_update_meta', updateMeta)
		return () => <Default>
			{() => {
				// const ret = [<button onClick={() => console.log(Object.entries(meta))}>show</button>]
				const ret = []
				const generateMenu = (i_current?: TocEntry): VNode => {
					const value = i_current?.value;
					const id = i_current?.id;
					const depth = i_current?.depth
					if (!i_current?.children) {
						// 普通item
						return h('li',
							{ 
								class: "\
								px-2 my-1 border-l-3 text-gray-600  \
								hover:(border-green-700  text-blue-500 bg-gray-50 hand) ",
							},
							[
								h('a',{href: "#" + id}, [value])
							])
					} else {
						return h(
							'div',
							{
								class: "",
							},
							[
								// 下拉菜单标题	
								h(
									'div',
									{
										class: "\
											hover(hand )\
										",
										onclick: () => {
											document.getElementById("submenu" + id)?.toggleAttribute("hidden")
										}
									},
									[
										h('div',{
											// "⯅	⯆	⯇	⯈"
										}, [ "⯈ " + value])
									]
								),
								h(
									'ul', // 下拉菜单
									{
										id: "submenu" + id,
										class: "mx-5 \
											hover(hand )\
										",
									},
									[
										i_current?.children?.map(x => generateMenu(x))
									]
								)
							]
						);
					} 
				}

				if (slots.default) {
					ret.push(
						<div class="">
							<div class="">
								{/* <p>{meta.frontmatter?.title ?? 'Loading'}</p> */}
								<div class="h-160  w-70 overflow-y-scroll overflow-x-hidden fixed top-3.6em left-0 ">
								</div>
							</div>
							<div class="">
								<div>
									<div class="ml-70 mr-70  bg-green-200 ">
										<article  class="mx-auto flex-1 prose bg-blue-200">
											{slots.default()}
										</article>
										<div class="w-70 overflow-y-scroll overflow-x-hidden fixed top-3.6em right-0 bg-yello-400">
											<div class="h-160 rounded">
												{ generateMenu(meta.toc?.at(0)) }
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					)
				}
				return ret
			}}
		</Default>
	}
})
